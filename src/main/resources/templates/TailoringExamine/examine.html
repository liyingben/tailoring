<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <!-- import CSS -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
</head>
<body>
<div id="app">
    <h3>布料使用记录</h3>

    <el-form :inline="true" :model="examineDetailsData.tailoringPlan" class="demo-form-inline">
        <el-form-item label="裁剪人员：">
            {{examineDetailsData.tailoringPlan.group}} {{examineDetailsData.tailoringPlan.member}}
        </el-form-item>
        <el-form-item label="日期：">
            {{examineDetailsData.tailoringPlan.dueDate}}
        </el-form-item>
        <el-form-item label="NO:">
            <el-input v-model="examineDetailsData.tailoringPlan.no" placeholder="NO:"></el-input>
        </el-form-item>
        <el-form-item label="版本号:">
            1.00
        </el-form-item>
        <el-form-item>
            <el-button type="primary" @click="examinePass">审核通过</el-button>
        </el-form-item>

        <el-form-item>
            <el-button type="primary" @click="onSubmit">冲销</el-button>
        </el-form-item>
    </el-form>
    <el-form :inline="true" :model="examineDetailsData.tailoringPlan" class="demo-form-inline">
        <el-form-item label="布料编码：">
            {{examineDetailsData.tailoringPlan.fabricCode}}
        </el-form-item>
        <el-form-item label="颜色：">
            {{examineDetailsData.tailoringPlan.fabricColour}}
        </el-form-item>
        <el-form-item label="幅宽：">
            {{examineDetailsData.tailoringPlan.fabricWidthMeter}}
        </el-form-item>
        <el-form-item label="克重：">
            {{examineDetailsData.tailoringPlan.fabricWeight}}
        </el-form-item>
    </el-form>
    <el-container>
        <el-table
                :data="examineDetailsData.tailoringDetails"
                style="width: 100%">
            <el-table-column
                    prop="typeNumber"
                    label="版号"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="workOrderNo"
                    label="加工单号"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="productCode"
                    label="成品号码">
            </el-table-column>

            <el-table-column
                    prop="productQuantity"
                    label="成品数量">
            </el-table-column>

            <el-table-column
                    prop="quantity"
                    label="扎数">
            </el-table-column>

            <el-table-column
                    prop="address"
                    label="排版（件）">
            </el-table-column>

            <el-table-column
                    prop="sum_length"
                    label="总长度（米）">
            </el-table-column>
            <el-table-column
                    prop="address"
                    label="拉布层数">
            </el-table-column>
            <el-table-column
                    prop="address"
                    label="布料用量（平方米）">
            </el-table-column>

            <el-table-column
                    prop="address"
                    label="单件用量*系数（米）">
            </el-table-column>

            <el-table-column
                    prop="address"
                    label="布料消耗用量（SQM）">
            </el-table-column>
        </el-table>

    </el-container>
    <el-container>
        <el-table
                :data="examineDetailsData.tailoringFabricRecords"
                border
                height="400"
                :summary-method="getSummaries"
                show-summary
                style="width: 100%;">
            <el-table-column
                    prop="typeNumber"
                    label="版号"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="reelNumber"
                    label="布料卷号">
            </el-table-column>
            <el-table-column
                    prop="lotNumber"
                    label="布批">
            </el-table-column>
            <el-table-column
                    prop="theoryLength"
                    label="理论长度(米)">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="拉布长度(米)">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="层数">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="实际长度(米)">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="换片(米)">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="差异(米)">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="布头余数(米)">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="备注">
            </el-table-column>


        </el-table>
    </el-container>
    <h4>布料消耗分配</h4>
    <el-container>
        <el-table
                :data="examineDetailsData.tailoringFabricConsumes"
                border
                style="width: 100%;">
            <el-table-column
                    prop="id"
                    label="总长度"
                    width="180">
            </el-table-column>
            <el-table-column
                    prop="name"
                    label="标准件数">
            </el-table-column>
            <el-table-column
                    prop="amount1"
                    label="系数">
            </el-table-column>
            <el-table-column
                    prop="amount2"
                    label="超与省">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="主辅区分">
            </el-table-column>

            <el-table-column
                    prop="amount3"
                    label="布批区分">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="换片数量">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="换片用量（SQM）">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="换片单件用量(M)">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="分配后用量（SQM）">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="分配比例">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="短少/溢余">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="装箱量">
            </el-table-column>
            <el-table-column
                    prop="amount3"
                    label="箱数">
            </el-table-column>
        </el-table>
    </el-container>
    <el-container>
        <el-form :inline="true" :model="examineDetailsData.tailoringPlan" class="demo-form-inline" style="width: 100%; margin-top: 20px">
            <el-form-item label="审核人">
                <el-input v-model="examineDetailsData.tailoringPlan.checkName" placeholder="审核人"></el-input>
            </el-form-item>
            <el-form-item label="审核日期">
                <el-input v-model="examineDetailsData.tailoringPlan.checkDate" placeholder="审核日期"></el-input>
            </el-form-item>
        </el-form>
    </el-container>


</div>
</body>
<script src="http://momentjs.cn/downloads/moment.min.js"></script>
<!-- import Vue before Element -->
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<!-- import JavaScript -->
<script src="https://unpkg.com/element-ui/lib/index.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
<script>
    var router = new VueRouter({
        mode: 'history',
        routes: []
    });
    new Vue({
        router,
        el: '#app',
        data: function () {
            return {
                examineDetailsData:{"tailoringDetail":{"id":1,"createTime":"2019-12-04T12:10:08.000+0000","updateTime":"2019-12-04T12:10:17.000+0000","tailoringId":1,"tailoringPlanId":1,"workOrderNo":"1","typeGroup":"1","productLineNo":1,"productCode":"1","productQuantity":1,"fabricCode":null,"sumLength":null,"theoryLength":null,"spreadingLength":null,"spreadingCount":null,"floor":null,"quantity":null,"bindingQuantity":null,"changePiecesQuantity":null},"tailoringPlan":{"id":1,"createTime":"2019-12-03T04:11:34.000+0000","updateTime":"2019-12-07T14:34:25.000+0000","workOrderNo":"1","status":"1","typeNumber":"1","group":"G91","member":"郑金成,刘小辉,","mainSupplement":"辅","quantity":1,"dueDate":"2019-11-02T12:38:36.000+0000","productLineNo":1,"productCode":"1","fabricCode":"1","fabricWidth":0.99,"fabricColour":"1","boxQuantity":1,"bindingQuantity":3,"changePiecesQuantity":5},"tailoringFabricRecords":[{"id":1,"createTime":"2019-12-04T07:50:12.000+0000","updateTime":"2019-12-04T07:50:12.000+0000","tailoringId":1,"fabricCode":"123","reelNumber":123,"lotNumber":12,"theoryLength":14.0},{"id":2,"createTime":"2019-12-04T07:50:12.000+0000","updateTime":"2019-12-04T07:50:12.000+0000","tailoringId":1,"fabricCode":"123","reelNumber":123,"lotNumber":12,"theoryLength":14.5},{"id":3,"createTime":"2019-12-04T07:50:12.000+0000","updateTime":"2019-12-04T07:50:12.000+0000","tailoringId":null,"fabricCode":"6666666","reelNumber":6666666,"lotNumber":6666666,"theoryLength":null},{"id":4,"createTime":"2019-12-04T07:50:12.000+0000","updateTime":"2019-12-04T07:50:12.000+0000","tailoringId":null,"fabricCode":"6666666","reelNumber":6666666,"lotNumber":6666666,"theoryLength":null},{"id":5,"createTime":"2019-12-04T07:50:12.000+0000","updateTime":"2019-12-04T07:50:12.000+0000","tailoringId":null,"fabricCode":"6666666","reelNumber":6666666,"lotNumber":6666666,"theoryLength":null},{"id":6,"createTime":"2019-12-04T07:50:12.000+0000","updateTime":"2019-12-04T07:50:12.000+0000","tailoringId":null,"fabricCode":"6666666","reelNumber":6666666,"lotNumber":6666666,"theoryLength":null}],"tailoringFabricConsume":{"id":1,"createTime":"2019-12-04T11:44:35.000+0000","updateTime":"2019-12-04T11:44:35.000+0000","workOrderNo":"1","productCode":"1","productLineNo":1,"consumeQuantity":1.0,"erpflag":"1","erpid":"1","erpdatum":null}},

            }
        },
        mounted() {
            var id = this.$route.query.id;
            this.examineDetails(id);
        },
        methods: {

            onSubmit(){

            },
            getSummaries(param) {
                const {columns, data} = param;
                const sums = [];
                columns.forEach((column, index) => {
                    if (index === 0) {
                        sums[index] = '总计';
                        return;
                    }
                    const values = data.map(item => Number(item[column.property]));
                    if (!values.every(value => isNaN(value))) {
                        sums[index] = values.reduce((prev, curr) => {
                            const value = Number(curr);
                            if (!isNaN(value)) {
                                return prev + curr;
                            } else {
                                return prev;
                            }
                        }, 0);
                        sums[index] ;
                    } else {
                        sums[index] = 'N/A';
                    }
                });

                return sums;
            },
            examineDetails: function (id) {
                axios.get('/tailoring/examineDetails', {
                    params: {
                        id: this.$route.query.id
                    }
                }).then((response) => {
                    this.examineDetailsData = response.data.data;
                }).catch(function (error) {
                    console.log(error);
                });
            },
            examinePass: function () {
                axios.post('/tailoring/examinePass', {
                    id: this.$route.query.id,
                    checkName: "主任"
                }).then((response) => {
                    response.data.data;
                }).catch(function (error) {
                    console.log(error);
                });
            },
        }
    })
</script>
</html>